<script>
    let { default: Animals } = await import('./apis/Animals.js');

    const animal = { "id": state[0], "animal": state[1], "sound": state[2], "icon": state[3] };
    const span = shadowDocument.querySelector("span");
    const strong = shadowDocument.querySelector("strong");

    span.innerHTML = animal.icon;
    strong.innerHTML = `Beware of the ${animal.animal}!`;

    const quickDelete = shadowDocument.querySelector("quick-delete");
    quickDelete.dataset.state = JSON.stringify({ id: animal.id });
    quickDelete.addEventListener("click", (e) => {
        let state = JSON.parse(quickDelete.dataset.state)
        Animals.deleteAnimal({ id: state.id }).then(() => {
            Animals.getAnimals().then(animals => {
                shadowDocument.dispatchEvent(
                    new CustomEvent("refresh", {
                        bubbles: true,
                        cancelable: false,
                        composed: true
                    })
                );
            });
        });
    })

    shadowDocument.querySelector("strong").addEventListener("click", () => { console.log(animal.sound) });
</script>

<style>
    :host {
        width: 50vw;
        display: flex;
    }

    li {
        width: 100%;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    strong {
        background-color: firebrick;
        color: white;
        padding: 4px;
        text-align: center;
        flex-grow: 2
    }
</style>

<template>
    <li>
        <span></span><strong></strong><quick-delete></quick-delete>
    </li>
</template>