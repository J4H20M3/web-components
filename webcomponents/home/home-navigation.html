<script>
    let { default: Animals } = await import('./apis/Animals.js');

    const nav = shadowDocument.getElementById("nav");

    window.onscroll = function () { stickyNavbar() };

    var sticky = nav.offsetTop;

    function stickyNavbar() {
        if (window.pageYOffset >= sticky) {
            nav.classList.add("sticky")
        } else {
            nav.classList.remove("sticky");
        }
    }

    shadowDocument.querySelectorAll("a.navlink").forEach(a => {
        a.addEventListener("click", function (event) {
            event.preventDefault();
            nav.querySelector(".active").classList.remove("active");
            event.target.classList.add("active");
            const url = event.target.getAttribute("href");
            go(url);
        });
    });
    // Back button clicked
    window.addEventListener("popstate", function (event) {
        // TODO: fix back button
        if (event.state) {
            go(event.state.route, false);
        }
    });

    let section = null;
    function getSection() {
        return new Promise((resolve) => {
            const checkAgain = function () {
                if (section) {
                    resolve(section);
                } else
                    setTimeout(checkAgain, 0);
            }
            checkAgain();
        });
    }

    // go("/path")
    window.go = function (route, addToHistory = true) {
        if (addToHistory) {
            history.pushState({ route }, null, route);
        }
        switch (route) {
            case "/":
                section = document.createElement("views-main");
                break;
            case "/animals":
                section = document.createElement("animals-view");
                break;
            default:
        }
        getSection().then(section => {
            const main = shadowDocument.querySelector("#main");
            main.replaceChildren(section);
            // move to top
            window.scrollX = 0;
            window.scrollY = 0;
        })
        shadowDocument.querySelectorAll("a.navlink").forEach(a => {
            a.classList.remove("active");
            if (a.getAttribute("href") == location.pathname) {
                a.classList.add("active");
            }
        });
    }
    // Check the initial URL
    go(location.pathname);
</script>

<style>
    nav {
        background-color: #144000;
        overflow: hidden;
        margin: 0;
    }

    nav a {
        float: left;
        color: #ffd700;
        display: block;
        text-align: center;
        padding: 4vh;
        text-decoration: none;
        font-size: 4vh;
        font-weight: 600;
    }

    nav a:hover {
        background-color: #ffff00;
        color: #144000;
    }

    nav a.active {
        background-color: #ffd700;
        color: #144000;
    }

    nav a.hidden {
        display: none;
    }

    .sticky {
        position: fixed;
        top: 0;
        width: 100%;
    }
</style>

<template>
    <nav id="nav">
        <a class="navlink active" href="/">üè†</a>
        <a class="navlink active" href="/animals">Animals</a>
    </nav>
    <main id="main"></main>
</template>